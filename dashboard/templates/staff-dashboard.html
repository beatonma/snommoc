<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dashboard</title>
    {% include 'style-fragment.html' %}
</head>
<body>
<header>{% include 'dashboard-header-fragment.html' %}</header>
<section>
    <h1>Dashboard</h1>
    <a class="button" href="{% url 'dashboard-mps' %}">{{ mp_count }} MPs</a>
    <a class="button" href="{% url 'dashboard-lords' %}">{{ lord_count }} Lords</a>
    <a class="button" href="{% url 'dashboard-constituencies' %}">{{ constituency_count }} constituencies</a>
    <a class="button" href="{% url 'dashboard-parties' %}">{{ party_count }} parties</a>
</section>

<section>
    <h1>API</h1>
    <a class="button" href="{% url 'member-list' %}">Members</a>
    <a class="button" href="{% url 'constituency-list' %}">Constituencies</a>
    <a class="button" href="{% url 'party-list' %}">Parties</a>
</section>

<section>
    <h1>Actions</h1>
{#    <span id="update_parties" class="action" >Update parties</span>#}
{#    <span id="update_constituencies" class="action" >Update constituencies</span>#}
{#    <span id="update_mps" class="action">Update MPs</span>#}
    <span id="rebuild_all" class="action">Clear and rebuild everything!</span>
</section>
</body>
<script type="text/javascript">
    (() => {
        function updateConstituencies() {
            const button = document.getElementById('update_constituencies');
            const buttonText = button.innerText;
            button.innerText = 'Busy...';
            button.classList.add('busy');
            button.removeEventListener('click', updateConstituencies);
            console.log('Updating constituencies...');
            fetch('{% url "action-update-constituencies" %}', {
                method: 'GET',
                credentials: 'same-origin'
            }).then((response) => {
                button.classList.remove('busy');
                button.innerText = buttonText;
                console.log('Constituencies updated');
                console.log(`${response.status}: ${response.text()}`);
                button.addEventListener('click', updateConstituencies);
            });
        }

        function updateMps() {
            const button = document.getElementById('update_mps');
            const buttonText = button.innerText;
            button.innerText = 'Busy...';
            button.classList.add('busy');
            button.removeEventListener('click', updateMps);
            console.log('Updating mps...');
            fetch('{% url "action-update-mps" %}', {
                method: 'GET',
                credentials: 'same-origin'
            }).then((response) => {
                button.classList.remove('busy');
                button.innerText = buttonText;
                console.log('MPs updated');
                console.log(`${response.status}: ${response.text()}`);
                button.addEventListener('click', updateMps);
            });
        }

        function updateParties() {
            const button = document.getElementById('update_parties');
            const buttonText = button.innerText;
            button.innerText = 'Busy...';
            button.classList.add('busy');
            button.removeEventListener('click', updateParties);
            console.log('Updating parties...');
            fetch('{% url "action-update-parties" %}', {
                method: 'GET',
                credentials: 'same-origin'
            }).then((response) => {
                button.classList.remove('busy');
                button.innerText = buttonText;
                console.log('Parties updated');
                console.log(`${response.status}: ${response.text()}`);
                button.addEventListener('click', updateParties);
            });
        }

        function rebuildAll() {
            const button = document.getElementById('rebuild_all');
            const buttonText = button.innerText;
            button.innerText = 'Busy...';
            button.classList.add('busy');
            button.removeEventListener('click', rebuildAll);
            console.log('Rebuilding all data...');
            fetch('{% url "action-rebuild-all" %}', {
                method: 'GET',
                credentials: 'same-origin'
            }).then((response) => {
                button.classList.remove('busy');
                button.innerText = buttonText;
                console.log('All data rebuilt');
                console.log(`${response.status}: ${response.text()}`);
                button.addEventListener('click', rebuildAll);
            });
        }

        {#document.getElementById('update_constituencies').addEventListener('click', updateConstituencies);#}
        {#document.getElementById('update_mps').addEventListener('click', updateMps);#}
        {#document.getElementById('update_parties').addEventListener('click', updateParties);#}
        document.getElementById('rebuild_all').addEventListener('click', rebuildAll);
    })();
</script>
</html>
